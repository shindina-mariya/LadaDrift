<?php
/**
 * Конфигурация подключения к базе данных
 * LADA Drift - Дрифт на автомобилях LADA
 *
 * Скопируйте этот файл как database.php и заполните учётные данные:
 * cp database.php.example database.php
 */

define('DB_HOST', 'localhost');
define('DB_NAME', 'lada_drift');
define('DB_USER', 'your_username');
define('DB_PASS', 'your_password');
define('DB_CHARSET', 'utf8mb4');

/**
 * Класс Database - Singleton для работы с базой данных
 */
class Database {
    private static ?PDO $instance = null;

    private function __construct() {}
    private function __clone() {}

    public static function getConnection(): PDO {
        if (self::$instance === null) {
            try {
                $dsn = sprintf(
                    "mysql:host=%s;dbname=%s;charset=%s",
                    DB_HOST,
                    DB_NAME,
                    DB_CHARSET
                );
                $options = [
                    PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
                    PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
                    PDO::ATTR_EMULATE_PREPARES => false,
                    PDO::ATTR_PERSISTENT => true
                ];
                self::$instance = new PDO($dsn, DB_USER, DB_PASS, $options);
            } catch (PDOException $e) {
                error_log("Ошибка подключения к БД: " . $e->getMessage());
                throw new PDOException("Ошибка подключения к базе данных. Попробуйте позже.");
            }
        }
        return self::$instance;
    }

    public static function closeConnection(): void {
        self::$instance = null;
    }

    public static function query(string $sql): PDOStatement {
        return self::getConnection()->query($sql);
    }

    public static function execute(string $sql, array $params = []): PDOStatement {
        $stmt = self::getConnection()->prepare($sql);
        $stmt->execute($params);
        return $stmt;
    }

    public static function lastInsertId(): string {
        return self::getConnection()->lastInsertId();
    }

    public static function beginTransaction(): bool {
        return self::getConnection()->beginTransaction();
    }

    public static function commit(): bool {
        return self::getConnection()->commit();
    }

    public static function rollback(): bool {
        return self::getConnection()->rollBack();
    }
}
